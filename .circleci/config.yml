version: 2.1
jobs:
  build:
    machine:
      image: ubuntu-1604:201903-01
    steps:
      - checkout
      - run: echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
      - run: docker build -t jspc/ci-worker:latest -t jspc/ci-worker:$CIRCLE_TAG .
      - run: docker push jspc/ci-worker

workflows:
  version: 2
  build_and_deploy:
    jobs:
      - build:
          context: BUILD
          filters:
            branches:
              ignore: /.*/
            tags:
              only: /.*/
